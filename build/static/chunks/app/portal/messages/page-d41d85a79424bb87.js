(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[678],{5142:(e,s,a)=>{"use strict";a.d(s,{p:()=>i});var t=a(5155);a(2115);var r=a(1197);function i({className:e,type:s,...a}){return(0,t.jsx)("input",{type:s,"data-slot":"input",className:(0,r.cn)("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border px-3 py-1 text-base bg-input-background transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",e),...a})}},5299:(e,s,a)=>{"use strict";a.d(s,{A:()=>t});let t=(0,a(1847).A)("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},5948:(e,s,a)=>{Promise.resolve().then(a.bind(a,9497))},7101:(e,s,a)=>{"use strict";a.d(s,{J:()=>d});var t=a(5155),r=a(2115);a(7650);var i=a(2467),n=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"].reduce((e,s)=>{let a=(0,i.TL)(`Primitive.${s}`),n=r.forwardRef((e,r)=>{let{asChild:i,...n}=e;return"undefined"!=typeof window&&(window[Symbol.for("radix-ui")]=!0),(0,t.jsx)(i?a:s,{...n,ref:r})});return n.displayName=`Primitive.${s}`,{...e,[s]:n}},{}),l=r.forwardRef((e,s)=>(0,t.jsx)(n.label,{...e,ref:s,onMouseDown:s=>{s.target.closest("button, input, select, textarea")||(e.onMouseDown?.(s),!s.defaultPrevented&&s.detail>1&&s.preventDefault())}}));l.displayName="Label";var c=a(1197);function d({className:e,...s}){return(0,t.jsx)(l,{"data-slot":"label",className:(0,c.cn)("flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",e),...s})}},8332:(e,s,a)=>{"use strict";a.d(s,{Fc:()=>l,TN:()=>c});var t=a(5155);a(2115);var r=a(3101),i=a(1197);let n=(0,r.F)("relative w-full rounded-lg border px-4 py-3 text-sm grid has-[>svg]:grid-cols-[calc(var(--spacing)*4)_1fr] grid-cols-[0_1fr] has-[>svg]:gap-x-3 gap-y-0.5 items-start [&>svg]:size-4 [&>svg]:translate-y-0.5 [&>svg]:text-current",{variants:{variant:{default:"bg-card text-card-foreground",destructive:"text-destructive bg-card [&>svg]:text-current *:data-[slot=alert-description]:text-destructive/90"}},defaultVariants:{variant:"default"}});function l({className:e,variant:s,...a}){return(0,t.jsx)("div",{"data-slot":"alert",role:"alert",className:(0,i.cn)(n({variant:s}),e),...a})}function c({className:e,...s}){return(0,t.jsx)("div",{"data-slot":"alert-description",className:(0,i.cn)("text-muted-foreground col-start-2 grid justify-items-start gap-1 text-sm [&_p]:leading-relaxed",e),...s})}},9497:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>S});var t=a(5155),r=a(2115),i=a(2024),n=a(3998),l=a(5142),c=a(1197);function d({className:e,...s}){return(0,t.jsx)("textarea",{"data-slot":"textarea",className:(0,c.cn)("resize-none border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-input-background px-3 py-2 text-base transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",e),...s})}var o=a(7101),m=a(6948),u=a(8332),x=a(1647),p=a(7910),h=a(1847);let g=(0,h.A)("key",[["path",{d:"m15.5 7.5 2.3 2.3a1 1 0 0 0 1.4 0l2.1-2.1a1 1 0 0 0 0-1.4L19 4",key:"g0fldk"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}]]);var j=a(5299);let y=(0,h.A)("send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);function v({onSendMessage:e,recipients:s=[]}){let[i,c]=(0,r.useState)(""),[h,v]=(0,r.useState)(""),[f,b]=(0,r.useState)(""),[N,w]=(0,r.useState)(!1),[P,k]=(0,r.useState)(!1),[S,E]=(0,r.useState)(""),[A,C]=(0,r.useState)(""),[K,M]=(0,r.useState)(null);(0,r.useEffect)(()=>{(async()=>{try{let e=await a.e(261).then(a.bind(a,1965));M(e)}catch(e){console.error("Failed to load OpenPGP:",e),E("PGP encryption not available")}})()},[]);let F=s.find(e=>e.id===i),B=async()=>{if(!i||!h||!f)return void E("Please fill in all fields");if(!F?.publicKey)return void E("Recipient does not have a PGP public key");if(!K)return void E("PGP encryption not available");w(!0),E("");try{let s=await K.readKey({armoredKey:F.publicKey}),a=(await K.encrypt({message:await K.createMessage({text:f}),encryptionKeys:s})).toString();w(!1),k(!0),await e({recipientId:i,subject:h,content:f,encryptedContent:a}),C("Message sent successfully!"),c(""),v(""),b(""),setTimeout(()=>C(""),3e3)}catch(e){console.error("Failed to send message:",e),E("Failed to send message. Please try again.")}finally{w(!1),k(!1)}};return(0,t.jsxs)(m.Zp,{children:[(0,t.jsxs)(m.aR,{children:[(0,t.jsxs)(m.ZB,{className:"flex items-center",children:[(0,t.jsx)(p.A,{className:"h-5 w-5 mr-2"}),"Secure Message Composer"]}),(0,t.jsx)(m.BT,{children:"Send encrypted messages using PGP. Only the recipient can decrypt and read the content."})]}),(0,t.jsxs)(m.Wu,{className:"space-y-4",children:[S&&(0,t.jsx)(u.Fc,{variant:"destructive",children:(0,t.jsx)(u.TN,{children:S})}),A&&(0,t.jsx)(u.Fc,{children:(0,t.jsx)(u.TN,{children:A})}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(o.J,{htmlFor:"recipient",children:"Recipient"}),(0,t.jsxs)("select",{id:"recipient",value:i,onChange:e=>c(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent",children:[(0,t.jsx)("option",{value:"",children:"Select a recipient..."}),s.map(e=>(0,t.jsxs)("option",{value:e.id,children:[e.name," (",e.email,")"]},e.id))]}),F&&(0,t.jsx)("div",{className:"flex items-center space-x-2",children:(0,t.jsxs)(x.E,{variant:F.publicKey?"default":"destructive",children:[(0,t.jsx)(g,{className:"h-3 w-3 mr-1"}),F.publicKey?"PGP Enabled":"No PGP Key"]})})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(o.J,{htmlFor:"subject",children:"Subject"}),(0,t.jsx)(l.p,{id:"subject",value:h,onChange:e=>v(e.target.value),placeholder:"Message subject..."})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(o.J,{htmlFor:"content",children:"Message"}),(0,t.jsx)(d,{id:"content",value:f,onChange:e=>b(e.target.value),placeholder:"Type your secure message here...",rows:6})]}),(0,t.jsx)("div",{className:"flex justify-end",children:(0,t.jsx)(n.$,{onClick:B,disabled:N||P||!i||!h||!f,children:N?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(j.A,{className:"h-4 w-4 mr-2 animate-spin"}),"Encrypting..."]}):P?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(j.A,{className:"h-4 w-4 mr-2 animate-spin"}),"Sending..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(y,{className:"h-4 w-4 mr-2"}),"Send Secure Message"]})})}),(0,t.jsxs)("div",{className:"text-xs text-gray-500 bg-gray-50 p-3 rounded-md",children:[(0,t.jsx)("p",{className:"font-medium mb-1",children:"\uD83D\uDD12 End-to-End Encryption"}),(0,t.jsx)("p",{children:"Messages are encrypted using PGP before transmission. Only the intended recipient can decrypt and read the content."})]})]})]})}var f=a(5897),b=a(3406);let N=(0,h.A)("inbox",[["polyline",{points:"22 12 16 12 14 15 10 15 8 12 2 12",key:"o97t9d"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}]]);var w=a(7586);let P=(0,h.A)("eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),k=(0,h.A)("eye-off",[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);function S(){let[e,s]=(0,r.useState)([]),[a,l]=(0,r.useState)([]),[c,d]=(0,r.useState)(!0),[o,u]=(0,r.useState)(null),[h,g]=(0,r.useState)("");(0,r.useEffect)(()=>{j(),S()},[]);let j=async()=>{try{let e=await fetch("/api/messages");if(e.ok){let a=await e.json();s(a.messages)}}catch(e){console.error("Failed to load messages:",e)}finally{d(!1)}},S=async()=>{l([{id:"1",name:"Alice Johnson",email:"alice@pratejra.build",publicKey:"-----BEGIN PGP PUBLIC KEY BLOCK-----\n...\n-----END PGP PUBLIC KEY BLOCK-----"},{id:"2",name:"Bob Smith",email:"bob@pratejra.build",publicKey:"-----BEGIN PGP PUBLIC KEY BLOCK-----\n...\n-----END PGP PUBLIC KEY BLOCK-----"}])},E=async e=>{try{if((await fetch("/api/messages",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).ok)await j();else throw Error("Failed to send message")}catch(e){throw console.error("Failed to send message:",e),e}},A=async e=>{u(e),g(e.content)},C=e=>new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),K=e.filter(e=>!e.isRead).length;return(0,t.jsx)(i.t,{children:(0,t.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,t.jsxs)("div",{className:"mb-8",children:[(0,t.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Secure Messages"}),(0,t.jsx)("p",{className:"mt-2 text-gray-600",children:"End-to-end encrypted communication for project collaboration"})]}),(0,t.jsxs)(b.tU,{defaultValue:"inbox",className:"space-y-6",children:[(0,t.jsxs)(b.j7,{children:[(0,t.jsxs)(b.Xi,{value:"inbox",className:"flex items-center",children:[(0,t.jsx)(N,{className:"h-4 w-4 mr-2"}),"Inbox",K>0&&(0,t.jsx)(x.E,{variant:"destructive",className:"ml-2",children:K})]}),(0,t.jsxs)(b.Xi,{value:"compose",children:[(0,t.jsx)(y,{className:"h-4 w-4 mr-2"}),"Compose"]})]}),(0,t.jsx)(b.av,{value:"inbox",className:"space-y-6",children:(0,t.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,t.jsx)("div",{className:"lg:col-span-1",children:(0,t.jsxs)(m.Zp,{children:[(0,t.jsx)(m.aR,{children:(0,t.jsxs)(m.ZB,{className:"flex items-center",children:[(0,t.jsx)(w.A,{className:"h-5 w-5 mr-2"}),"Messages"]})}),(0,t.jsx)(m.Wu,{children:c?(0,t.jsx)("div",{className:"space-y-3",children:[void 0,void 0,void 0].map((e,s)=>(0,t.jsx)("div",{className:"animate-pulse",children:(0,t.jsx)("div",{className:"h-16 bg-gray-200 rounded"})},s))}):0===e.length?(0,t.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,t.jsx)(w.A,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),(0,t.jsx)("p",{children:"No messages yet"})]}):(0,t.jsx)("div",{className:"space-y-2",children:e.map(e=>(0,t.jsx)("div",{className:`p-3 rounded-lg border cursor-pointer transition-colors ${o?.id===e.id?"bg-primary/10 border-primary":"hover:bg-gray-50"} ${!e.isRead?"bg-blue-50 border-blue-200":""}`,onClick:()=>A(e),children:(0,t.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,t.jsxs)(f.eu,{className:"h-8 w-8",children:[(0,t.jsx)(f.BK,{src:""}),(0,t.jsx)(f.q5,{children:e.sender.name.charAt(0)})]}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("p",{className:"text-sm font-medium text-gray-900 truncate",children:e.sender.name}),!e.isRead&&(0,t.jsx)("div",{className:"h-2 w-2 bg-blue-500 rounded-full"})]}),(0,t.jsx)("p",{className:"text-sm text-gray-600 truncate",children:e.subject}),(0,t.jsx)("p",{className:"text-xs text-gray-500",children:C(e.createdAt)})]})]})},e.id))})})]})}),(0,t.jsx)("div",{className:"lg:col-span-2",children:(0,t.jsxs)(m.Zp,{children:[(0,t.jsxs)(m.aR,{children:[(0,t.jsxs)(m.ZB,{className:"flex items-center",children:[(0,t.jsx)(p.A,{className:"h-5 w-5 mr-2"}),o?o.subject:"Select a message"]}),o&&(0,t.jsxs)(m.BT,{children:["From ",o.sender.name," • ",C(o.createdAt),o.project&&(0,t.jsxs)("span",{className:"ml-2",children:["• Project: ",o.project.name]})]})]}),(0,t.jsx)(m.Wu,{children:o?(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg",children:[(0,t.jsxs)("div",{className:"flex items-center mb-2",children:[(0,t.jsx)(P,{className:"h-4 w-4 mr-2 text-green-600"}),(0,t.jsx)("span",{className:"text-sm font-medium text-green-600",children:"Encrypted Content (PGP)"})]}),(0,t.jsx)("pre",{className:"text-xs text-gray-600 whitespace-pre-wrap font-mono",children:h})]}),(0,t.jsxs)("div",{className:"flex space-x-2",children:[(0,t.jsx)(n.$,{size:"sm",variant:"outline",children:"Reply"}),(0,t.jsx)(n.$,{size:"sm",variant:"outline",children:"Forward"}),(0,t.jsx)(n.$,{size:"sm",variant:"outline",children:"Archive"})]})]}):(0,t.jsxs)("div",{className:"text-center py-12 text-gray-500",children:[(0,t.jsx)(k,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),(0,t.jsx)("p",{children:"Select a message to view its contents"}),(0,t.jsx)("p",{className:"text-sm mt-1",children:"All messages are end-to-end encrypted"})]})})]})})]})}),(0,t.jsx)(b.av,{value:"compose",children:(0,t.jsx)(v,{onSendMessage:E,recipients:a})})]})]})})}}},e=>{e.O(0,[618,532,832,579,938,441,255,358],()=>e(e.s=5948)),_N_E=e.O()}]);